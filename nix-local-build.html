

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.1. Quickstart &mdash; Cabal &lt;release&gt; User&#39;s Guide</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cabal &lt;release&gt; User&#39;s Guide" href="index.html"/>
        <link rel="up" title="5. Nix-style Local Builds" href="nix-local-build-overview.html"/>
        <link rel="prev" title="5. Nix-style Local Builds" href="nix-local-build-overview.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Cabal
          

          
            
            <img src="_static/Cabal-dark.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.25
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="config-and-install.html">2. Configuration and Installing Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts-and-development.html">3. Package Concepts and Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs-and-stability.html">4. Reporting Bugs and Stability of Cabal Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="nix-local-build-overview.html">5. Nix-style Local Builds</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.1. Quickstart</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#developing-multiple-packages">5.1.1. Developing multiple packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-it-works">5.2. How it works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#local-versus-external-packages">5.2.1. Local versus external packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#where-are-my-build-products">5.2.2. Where are my build products?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#caching">5.2.3. Caching</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#commands">5.3. Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cabal-new-configure">5.3.1. cabal new-configure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cabal-new-build">5.3.2. cabal new-build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cabal-new-repl">5.3.3. cabal new-repl</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cabal-new-freeze">5.3.4. cabal new-freeze</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unsupported-commands">5.3.5. Unsupported commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-builds-with-cabal-project">5.4. Configuring builds with cabal.project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#specifying-the-local-packages">5.4.1. Specifying the local packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-configuration-options">5.4.2. Global configuration options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solver-configuration-options">5.4.3. Solver configuration options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-configuration-options">5.4.4. Package configuration options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#object-code-options">5.4.4.1. Object code options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#executable-options">5.4.4.2. Executable options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-linking-options">5.4.4.3. Dynamic linking options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#foreign-function-interface-options">5.4.4.4. Foreign function interface options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profiling-options">5.4.4.5. Profiling options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coverage-options">5.4.4.6. Coverage options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#haddock-options">5.4.4.7. Haddock options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-global-configuration-options">5.4.5. Advanced global configuration options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#advanced-solver-options">5.4.5.1. Advanced solver options</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
  <a href="genindex.html">Index</a>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Cabal</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="nix-local-build-overview.html">5. Nix-style Local Builds</a> &raquo;</li>
      
    <li>5.1. Quickstart</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/nix-local-build.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<h1>5.1. Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>Suppose that you are in a directory containing a single Cabal package
which you wish to build. You can configure and build it using Nix-style
local builds with this command (configuring is not necessary):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cabal new-build
</pre></div>
</div>
<p>To open a GHCi shell with this package, use this command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cabal new-repl
</pre></div>
</div>
<div class="section" id="developing-multiple-packages">
<h2>5.1.1. Developing multiple packages<a class="headerlink" href="#developing-multiple-packages" title="Permalink to this headline">¶</a></h2>
<p>Many Cabal projects involve multiple packages which need to be built
together. To build multiple Cabal packages, you need to first create a
<code class="docutils literal"><span class="pre">cabal.project</span></code> file which declares where all the local package
directories live. For example, in the Cabal repository, there is a root
directory with a folder per package, e.g., the folders <code class="docutils literal"><span class="pre">Cabal</span></code> and
<code class="docutils literal"><span class="pre">cabal-install</span></code>. The <code class="docutils literal"><span class="pre">cabal.project</span></code> file specifies each folder as
part of the project:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">packages</span><span class="p">:</span> Cabal/
          cabal-install/
</pre></div>
</div>
<p>The expectation is that a <code class="docutils literal"><span class="pre">cabal.project</span></code> is checked into your source
control, to be used by all developers of a project. If you need to make
local changes, they can be placed in <code class="docutils literal"><span class="pre">cabal.project.local</span></code> (which
should not be checked in.)</p>
<p>Then, to build every component of every package, from the top-level
directory, run the command: (Warning: cabal-install-1.24 does NOT have
this behavior; you will need to upgrade to HEAD.)</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cabal new-build
</pre></div>
</div>
<p>To build a specific package, you can either run <code class="docutils literal"><span class="pre">new-build</span></code> from the
directory of the package in question:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> cabal-install
<span class="gp">$</span> cabal new-build
</pre></div>
</div>
<p>or you can pass the name of the package as an argument to
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> (this works in any subdirectory of the project):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cabal new-build cabal-install
</pre></div>
</div>
<p>You can also specify a specific component of the package to build. For
example, to build a test suite named <code class="docutils literal"><span class="pre">package-tests</span></code>, use the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cabal new-build package-tests
</pre></div>
</div>
<p>Targets can be qualified with package names. So to request
<code class="docutils literal"><span class="pre">package-tests</span></code> <em>from</em> the <code class="docutils literal"><span class="pre">Cabal</span></code> package, use
<code class="docutils literal"><span class="pre">Cabal:package-tests</span></code>.</p>
<p>Unlike sandboxes, there is no need to setup a sandbox or <code class="docutils literal"><span class="pre">add-source</span></code>
projects; just check in <code class="docutils literal"><span class="pre">cabal.project</span></code> to your repository and
<code class="docutils literal"><span class="pre">new-build</span></code> will just work.</p>
</div>
</div>
<div class="section" id="how-it-works">
<h1>5.2. How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<div class="section" id="local-versus-external-packages">
<h2>5.2.1. Local versus external packages<a class="headerlink" href="#local-versus-external-packages" title="Permalink to this headline">¶</a></h2>
<p>One of the primary innovations of Nix-style local builds is the
distinction between local packages, which users edit and recompile and
must be built per-project, versus external packages, which can be cached
across packages. To be more precise:</p>
<ol class="arabic simple">
<li>A <strong>local package</strong> is one that is listed explicitly in the
<code class="docutils literal"><span class="pre">packages</span></code>, <code class="docutils literal"><span class="pre">optional-packages</span></code> or <code class="docutils literal"><span class="pre">extra-packages</span></code> field of a
project. Usually, these refer to packages whose source code lives
directly in a folder in your project (although, you can list an
arbitrary Hackage package in <code class="docutils literal"><span class="pre">extra-packages</span></code> to force it to be
treated as local).</li>
</ol>
<p>Local packages, as well as the external packages (below) which depend on
them, are built <strong>inplace</strong>, meaning that they are always built
specifically for the project and are not installed globally. Inplace
packages are not cached and not given unique hashes, which makes them
suitable for packages which you want to edit and recompile.</p>
<ol class="arabic simple" start="2">
<li>An <strong>external package</strong> is any package which is not listed in the
<code class="docutils literal"><span class="pre">packages</span></code> field. The source code for external packages is usually
retrieved from Hackage.</li>
</ol>
<p>When an external package does not depend on an inplace package, it can
be built and installed to a <strong>global</strong> store, which can be shared across
projects. These build products are identified by a hash that over all of
the inputs which would influence the compilation of a package (flags,
dependency selection, etc.). Just as in Nix, these hashes uniquely
identify the result of a build; if we compute this identifier and we
find that we already have this ID built, we can just use the already
built version.</p>
<p>The global package store is <code class="docutils literal"><span class="pre">~/.cabal/store</span></code>; if you need to clear
your store for whatever reason (e.g., to reclaim disk space or because
the global store is corrupted), deleting this directory is safe
(<code class="docutils literal"><span class="pre">new-build</span></code> will just rebuild everything it needs on its next
invocation).</p>
<p>This split motivates some of the UI choices for Nix-style local build
commands. For example, flags passed to <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> are only
applied to <em>local</em> packages, so that adding a flag to
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> doesn&#8217;t necessitate a rebuild of <em>every</em> transitive
dependency in the global package store.</p>
<p>In cabal-install HEAD, Nix-style local builds also take advantage of a
new Cabal library feature, <a class="reference external" href="https://github.com/ezyang/ghc-proposals/blob/master/proposals/0000-componentized-cabal.rst">per-component
builds</a>,
where each component of a package is configured and built separately.
This can massively speed up rebuilds of packages with lots of components
(e.g., a package that defines multiple executables), as only one
executable needs to be rebuilt. Packages that use Custom setup scripts
are not currently built on a per-component basis.</p>
</div>
<div class="section" id="where-are-my-build-products">
<h2>5.2.2. Where are my build products?<a class="headerlink" href="#where-are-my-build-products" title="Permalink to this headline">¶</a></h2>
<p>A major deficiency in the current implementation of new-build is that
there is no programmatic way to access the location of build products.
The location of the build products is intended to be an internal
implementation detail of new-build, but we also understand that many
unimplemented features (e.g., <code class="docutils literal"><span class="pre">new-test</span></code>) can only be reasonably
worked around by accessing build products directly.</p>
<p>The location where build products can be found varies depending on the
version of cabal-install:</p>
<ul class="simple">
<li>In cabal-install-1.24, the dist directory for a package <code class="docutils literal"><span class="pre">p-0.1</span></code> is
stored in <code class="docutils literal"><span class="pre">dist-newstyle/build/p-0.1</span></code>. For example, if you built an
executable or test suite named <code class="docutils literal"><span class="pre">pexe</span></code>, it would be located at
<code class="docutils literal"><span class="pre">dist-newstyle/build/p-0.1/build/pexe/pexe</span></code>.</li>
<li>In cabal-install HEAD, the dist directory for a package <code class="docutils literal"><span class="pre">p-0.1</span></code>
defining a library built with GHC 8.0.1 on 64-bit Linux is
<code class="docutils literal"><span class="pre">dist-newstyle/build/x86_64-linux/ghc-8.0.1/p-0.1</span></code>. When
per-component builds are enabled (any non-Custom package), a
subcomponent like an executable or test suite named <code class="docutils literal"><span class="pre">pexe</span></code> will be
stored at
<code class="docutils literal"><span class="pre">dist-newstyle/build/x86_64-linux/ghc-8.0.1/p-0.1/c/pexe</span></code>; thus,
the full path of the executable is
<code class="docutils literal"><span class="pre">dist-newstyle/build/x86_64-linux/ghc-8.0.1/p-0.1/c/pexe/build/pexe/pexe</span></code>
(you can see why we want this to be an implementation detail!)</li>
</ul>
<p>The paths are a bit longer in HEAD but the benefit is that you can
transparently have multiple builds with different versions of GHC. We
plan to add the ability to create aliases for certain build
configurations, and more convenient paths to access particularly useful
build products like executables.</p>
</div>
<div class="section" id="caching">
<h2>5.2.3. Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h2>
<p>Nix-style local builds sport a robust caching system which help reduce
the time it takes to execute a rebuild cycle. While the details of how
<code class="docutils literal"><span class="pre">cabal-install</span></code> does caching are an implementation detail and may
change in the future, knowing what gets cached is helpful for
understanding the performance characteristics of invocations to
<code class="docutils literal"><span class="pre">new-build</span></code>. The cached intermediate results are stored in
<code class="docutils literal"><span class="pre">dist-newstyle/cache</span></code>; this folder can be safely deleted to clear the
cache.</p>
<p>The following intermediate results are cached in the following files in
this folder (the most important two are first):</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">solver-plan</span></code> (binary)</dt>
<dd>The result of calling the dependency solver, assuming that the
Hackage index, local <code class="docutils literal"><span class="pre">cabal.project</span></code> file, and local <code class="docutils literal"><span class="pre">cabal</span></code>
files are unmodified. (Notably, we do NOT have to dependency solve
again if new build products are stored in the global store; the
invocation of the dependency solver is independent of what is
already available in the store.)</dd>
<dt><code class="docutils literal"><span class="pre">source-hashes</span></code> (binary)</dt>
<dd>The hashes of all local source files. When all local source files of
a local package are unchanged, <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> will skip
invoking <code class="docutils literal"><span class="pre">setup</span> <span class="pre">build</span></code> entirely (saving us from a possibly
expensive call to <code class="docutils literal"><span class="pre">ghc</span> <span class="pre">--make</span></code>). The full list of source files
participating in compilation are determined using
<code class="docutils literal"><span class="pre">setup</span> <span class="pre">sdist</span> <span class="pre">--list-sources</span></code> (thus, if you do not list all your
source files in a Cabal file, you may fail to recompile when you
edit them.)</dd>
<dt><code class="docutils literal"><span class="pre">config</span></code> (same format as <code class="docutils literal"><span class="pre">cabal.project</span></code>)</dt>
<dd>The full project configuration, merged from <code class="docutils literal"><span class="pre">cabal.project</span></code> (and
friends) as well as the command line arguments.</dd>
<dt><code class="docutils literal"><span class="pre">compiler</span></code> (binary)</dt>
<dd>The configuration of the compiler being used to build the project.</dd>
<dt><code class="docutils literal"><span class="pre">improved-plan</span></code> (binary)</dt>
<dd>Like <code class="docutils literal"><span class="pre">solver-plan</span></code>, but with all non-inplace packages improved
into pre-existing copies from the store.</dd>
</dl>
<p>Note that every package also has a local cache managed by the Cabal
build system, e.g., in <code class="docutils literal"><span class="pre">$distdir/cache</span></code>.</p>
<p>There is another useful file in <code class="docutils literal"><span class="pre">dist-newstyle/cache</span></code>, <code class="docutils literal"><span class="pre">plan.json</span></code>,
which is a JSON serialization of the computed install plan. (TODO: docs)</p>
</div>
</div>
<div class="section" id="commands">
<h1>5.3. Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h1>
<p>We now give an in-depth description of all the commands, describing the
arguments and flags they accept.</p>
<div class="section" id="cabal-new-configure">
<h2>5.3.1. cabal new-configure<a class="headerlink" href="#cabal-new-configure" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span></code> takes a set of arguments and writes a
<code class="docutils literal"><span class="pre">cabal.project.local</span></code> file based on the flags passed to this command.
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span> <span class="pre">FLAGS;</span> <span class="pre">cabal</span> <span class="pre">new-build</span></code> is roughly equivalent to
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span> <span class="pre">FLAGS</span></code>, except that with <code class="docutils literal"><span class="pre">new-configure</span></code> the flags
are persisted to all subsequent calls to <code class="docutils literal"><span class="pre">new-build</span></code>.</p>
<p><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span></code> is intended to be a convenient way to write out
a <code class="docutils literal"><span class="pre">cabal.project.local</span></code> for simple configurations; e.g.,
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span> <span class="pre">-w</span> <span class="pre">ghc-7.8</span></code> would ensure that all subsequent
builds with <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> are performed with the compiler
<code class="docutils literal"><span class="pre">ghc-7.8</span></code>. For more complex configuration, we recommend writing the
<code class="docutils literal"><span class="pre">cabal.project.local</span></code> file directly (or placing it in
<code class="docutils literal"><span class="pre">cabal.project</span></code>!)</p>
<p><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span></code> inherits options from <code class="docutils literal"><span class="pre">Cabal</span></code>. semantics:</p>
<ul class="simple">
<li>Any flag accepted by <code class="docutils literal"><span class="pre">./Setup</span> <span class="pre">configure</span></code>.</li>
<li>Any flag accepted by <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">configure</span></code> beyond
<code class="docutils literal"><span class="pre">./Setup</span> <span class="pre">configure</span></code>, namely <code class="docutils literal"><span class="pre">--cabal-lib-version</span></code>,
<code class="docutils literal"><span class="pre">--constraint</span></code>, <code class="docutils literal"><span class="pre">--preference</span></code> and <code class="docutils literal"><span class="pre">--solver.</span></code></li>
<li>Any flag accepted by <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">install</span></code> beyond <code class="docutils literal"><span class="pre">./Setup</span> <span class="pre">configure</span></code>.</li>
<li>Any flag accepted by <code class="docutils literal"><span class="pre">./Setup</span> <span class="pre">haddock</span></code>.</li>
</ul>
<p>The options of all of these flags apply only to <em>local</em> packages in a
project; this behavior is different than that of <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">install</span></code>,
which applies flags to every package that would be built. The motivation
for this is to avoid an innocuous addition to the flags of a package
resulting in a rebuild of every package in the store (which might need
to happen if a flag actually applied to every transitive dependency). To
apply options to an external package, use a <code class="docutils literal"><span class="pre">package</span></code> stanza in a
<code class="docutils literal"><span class="pre">cabal.project</span></code> file.</p>
</div>
<div class="section" id="cabal-new-build">
<h2>5.3.2. cabal new-build<a class="headerlink" href="#cabal-new-build" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> takes a set of targets and builds them. It
automatically handles building and installing any dependencies of these
targets.</p>
<p>A target can take any of the following forms:</p>
<ul class="simple">
<li>A package target: <code class="docutils literal"><span class="pre">package</span></code>, which specifies that all enabled
components of a package to be built. By default, test suites and
benchmarks are <em>not</em> enabled, unless they are explicitly requested
(e.g., via <code class="docutils literal"><span class="pre">--enable-tests</span></code>.)</li>
<li>A component target: <code class="docutils literal"><span class="pre">[package:][ctype:]component</span></code>, which specifies
a specific component (e.g., a library, executable, test suite or
benchmark) to be built.</li>
</ul>
<p>In component targets, <code class="docutils literal"><span class="pre">package:</span></code> and <code class="docutils literal"><span class="pre">ctype:</span></code> (valid component types
are <code class="docutils literal"><span class="pre">lib</span></code>, <code class="docutils literal"><span class="pre">exe</span></code>, <code class="docutils literal"><span class="pre">test</span></code> and <code class="docutils literal"><span class="pre">bench</span></code>) can be used to
disambiguate when multiple packages define the same component, or the
same component name is used in a package (e.g., a package <code class="docutils literal"><span class="pre">foo</span></code>
defines both an executable and library named <code class="docutils literal"><span class="pre">foo</span></code>). We always prefer
interpreting a target as a package name rather than as a component name.</p>
<p>Some example targets:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> cabal new-build lib:foo-pkg       <span class="c1"># build the library named foo-pkg</span>
<span class="gp">$</span> cabal new-build foo-pkg:foo-tests <span class="c1"># build foo-tests in foo-pkg</span>
</pre></div>
</div>
<p>(There is also syntax for specifying module and file targets, but it
doesn&#8217;t currently do anything.)</p>
<p>Beyond a list of targets, <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> accepts all the flags that
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span></code> takes. Most of these flags are only taken into
consideration when building local packages; however, some flags may
cause extra store packages to be built (for example,
<code class="docutils literal"><span class="pre">--enable-profiling</span></code> will automatically make sure profiling libraries
for all transitive dependencies are built and installed.)</p>
</div>
<div class="section" id="cabal-new-repl">
<h2>5.3.3. cabal new-repl<a class="headerlink" href="#cabal-new-repl" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-repl</span> <span class="pre">TARGET</span></code> loads all of the modules of the target into
GHCi as interpreted bytecode. It takes the same flags as
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code>.</p>
<p>Currently, it is not supported to pass multiple targets to <code class="docutils literal"><span class="pre">new-repl</span></code>
(<code class="docutils literal"><span class="pre">new-repl</span></code> will just successively open a separate GHCi session for
each target.)</p>
</div>
<div class="section" id="cabal-new-freeze">
<h2>5.3.4. cabal new-freeze<a class="headerlink" href="#cabal-new-freeze" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-freeze</span></code> writes out a <code class="docutils literal"><span class="pre">cabal.project.freeze</span></code> file which
records all of the versions and flags which that are picked by the
solver under the current index and flags. A <code class="docutils literal"><span class="pre">cabal.project.freeze</span></code>
file has the same syntax as <code class="docutils literal"><span class="pre">cabal.project</span></code> and looks something like
this:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">constraints</span><span class="p">:</span> HTTP <span class="o">==</span>4000.3.3<span class="p">,</span>
             HTTP +warp-tests -warn-as-error -network23 +network-uri -mtl1 -conduit10<span class="p">,</span>
             QuickCheck <span class="o">==</span>2.9.1<span class="p">,</span>
             QuickCheck +templatehaskell<span class="p">,</span>
<span class="c1">             -- etc...</span>
</pre></div>
</div>
<p>For end-user executables, it is recommended that you distribute the
<code class="docutils literal"><span class="pre">cabal.project.freeze</span></code> file in your source repository so that all
users see a consistent set of dependencies. For libraries, this is not
recommended: users often need to build against different versions of
libraries than what you developed against.</p>
</div>
<div class="section" id="unsupported-commands">
<h2>5.3.5. Unsupported commands<a class="headerlink" href="#unsupported-commands" title="Permalink to this headline">¶</a></h2>
<p>The following commands are not currently supported:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-test</span></code> (<a class="reference external" href="https://github.com/haskell/cabal/issues/3638">#3638</a>)</dt>
<dd>Workaround: run the test executable directly (see <a class="reference external" href="#where-are-my-build-products">Where are my
build products</a>?)</dd>
<dt><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-bench</span></code> (<a class="reference external" href="https://github.com/haskell/cabal/issues/3638">#3638</a>)</dt>
<dd>Workaround: run the benchmark executable directly (see <a class="reference external" href="#where-are-my-build-products">Where are my
build products</a>?)</dd>
<dt><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-run</span></code> (<a class="reference external" href="https://github.com/haskell/cabal/issues/3638">#3638</a>)</dt>
<dd>Workaround: run the executable directly (see <a class="reference external" href="#where-are-my-build-products">Where are my build
products</a>?)</dd>
<dt><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-exec</span></code></dt>
<dd>Workaround: if you wanted to execute GHCi, consider using
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-repl</span></code> instead. Otherwise, use <code class="docutils literal"><span class="pre">-v</span></code> to find the list
of flags GHC is being invoked with and pass it manually.</dd>
<dt><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-haddock</span></code> (<a class="reference external" href="https://github.com/haskell/cabal/issues/3535">#3535</a>)</dt>
<dd>Workaround: run
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">act-as-setup</span> <span class="pre">--</span> <span class="pre">haddock</span> <span class="pre">--builddir=dist-newstyle/build/pkg-0.1</span></code>
(or execute the Custom setup script directly).</dd>
<dt><code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-install</span></code> (<a class="reference external" href="https://github.com/haskell/cabal/issues/3737">#3737</a>)</dt>
<dd>Workaround: no good workaround at the moment. (But note that you no
longer need to install libraries before building!)</dd>
</dl>
</div>
</div>
<div class="section" id="configuring-builds-with-cabal-project">
<h1>5.4. Configuring builds with cabal.project<a class="headerlink" href="#configuring-builds-with-cabal-project" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal"><span class="pre">cabal.project</span></code> files support a variety of options which configure the
details of your build. The general syntax of a <code class="docutils literal"><span class="pre">cabal.project</span></code> file is
similar to that of a Cabal file: there are a number of fields, some of
which live inside stanzas:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">packages</span><span class="p">:</span> */*.cabal
<span class="k">with-compiler</span><span class="p">:</span> /opt/ghc/8.0.1/bin/ghc

<span class="k">package</span> cryptohash
<span class="w">  </span><span class="k">optimization</span><span class="p">:</span> False
</pre></div>
</div>
<p>In general, the accepted field names coincide with the accepted command
line flags that <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">install</span></code> and other commands take. For example,
<code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span> <span class="pre">--library-profiling</span></code> will write out a project
file with <code class="docutils literal"><span class="pre">library-profiling:</span> <span class="pre">True</span></code>.</p>
<p>The full configuration of a project is determined by combining the
following sources (later entries override earlier ones):</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">~/.cabal/config</span></code> (the user-wide global configuration)</li>
<li><code class="docutils literal"><span class="pre">cabal.project</span></code> (the project configuratoin)</li>
<li><code class="docutils literal"><span class="pre">cabal.project.freeze</span></code> (the output of <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-freeze</span></code>)</li>
<li><code class="docutils literal"><span class="pre">cabal.project.local</span></code> (the output of <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-configure</span></code>)</li>
</ol>
<div class="section" id="specifying-the-local-packages">
<h2>5.4.1. Specifying the local packages<a class="headerlink" href="#specifying-the-local-packages" title="Permalink to this headline">¶</a></h2>
<p>The following top-level options specify what the local packages of a
project are:</p>
<p><code class="docutils literal"><span class="pre">packages:</span></code> <em>package location list</em> (space or comma separated,
default: <code class="docutils literal"><span class="pre">./*.cabal</span></code>)</p>
<blockquote>
<div><p>Specifies the list of package locations which contain the local
packages to be built by this project. Package locations can take the
following forms:</p>
<ol class="arabic simple">
<li>They can specify a Cabal file, or a directory containing a Cabal
file, e.g., <code class="docutils literal"><span class="pre">packages:</span> <span class="pre">Cabal</span> <span class="pre">cabal-install/cabal-install.cabal</span></code>.</li>
<li>They can specify a glob-style wildcards, which must match one or
more (a) directories containing a (single) Cabal file, (b) Cabal
files (extension <code class="docutils literal"><span class="pre">.cabal</span></code>), or (c) [STRIKEOUT:tarballs which
contain Cabal packages (extension <code class="docutils literal"><span class="pre">.tar.gz</span></code>)] (not implemented
yet). For example, to match all Cabal files in all
subdirectories, as well as the Cabal projects in the parent
directories <code class="docutils literal"><span class="pre">foo</span></code> and <code class="docutils literal"><span class="pre">bar</span></code>, use
<code class="docutils literal"><span class="pre">packages:</span> <span class="pre">*/*.cabal</span> <span class="pre">../{foo,bar}/</span></code></li>
<li>[STRIKEOUT:They can specify an <code class="docutils literal"><span class="pre">http</span></code>, <code class="docutils literal"><span class="pre">https</span></code> or <code class="docutils literal"><span class="pre">file</span></code>
URL, representing the path to a remote tarball to be downloaded
and built.] (not implemented yet)</li>
</ol>
<p>There is no command line variant of this field; see <a class="reference external" href="https://github.com/haskell/cabal/issues/3585">#3585</a>.</p>
</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">optional-packages:</span></code> <em>package location list</em> (space or comma-separated, default: <code class="docutils literal"><span class="pre">./*/*.cabal</span></code>)</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">packages:</span></code>, specifies a list of package locations containing
local packages to be built. Unlike <code class="docutils literal"><span class="pre">packages:</span></code>, if we glob for a
package, it is permissible for the glob to match against zero
packages. The intended use-case for <code class="docutils literal"><span class="pre">optional-packages</span></code> is to make
it so that vendored packages can be automatically picked up if they
are placed in a subdirectory, but not error if there aren&#8217;t any.</p>
<p class="last">There is no command line variant of this field.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">extra-packages:</span></code> <em>package list with version bounds</em> (comma separated)</dt>
<dd><p class="first">[STRIKEOUT:Specifies a list of external packages from Hackage which
should be considered local packages.] (Not implemented)</p>
<p class="last">There is no command line variant of this field.</p>
</dd>
</dl>
<p>[STRIKEOUT:There is also a stanza <code class="docutils literal"><span class="pre">source-repository-package</span></code> for
specifying packages from an external version control.] (Not
implemented.)</p>
<p>All local packages are <em>vendored</em>, in the sense that if other packages
(including external ones from Hackage) depend on a package with the name
of a local package, the local package is preferentially used.  This
motivates the default settings:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">packages</span><span class="p">:</span> ./*.cabal
<span class="k">optional-packages</span><span class="p">:</span> ./*/*.cabal
</pre></div>
</div>
<p>...any package can be vendored simply by making a checkout in the
top-level project directory, as might be seen in this hypothetical
directory layout:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">foo</span>.cabal
<span class="k">foo-helper</span>/     # local package
<span class="k">unix</span>/           # vendored external package
</pre></div>
</div>
<p>All of these options support globs. <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> has its own glob
format:</p>
<ul class="simple">
<li>Anywhere in a path, as many times as you like, you can specify an
asterisk <code class="docutils literal"><span class="pre">*</span></code> wildcard. E.g., <code class="docutils literal"><span class="pre">*/*.cabal</span></code> matches all <code class="docutils literal"><span class="pre">.cabal</span></code>
files in all immediate subdirectories. Like in glob(7), asterisks do
not match hidden files unless there is an explicit period, e.g.,
<code class="docutils literal"><span class="pre">.*/foo.cabal</span></code> will match <code class="docutils literal"><span class="pre">.private/foo.cabal</span></code> (but
<code class="docutils literal"><span class="pre">*/foo.cabal</span></code> will not).</li>
<li>You can use braces to specify specific directories; e.g.,
<code class="docutils literal"><span class="pre">{vendor,pkgs}/*.cabal</span></code> matches all Cabal files in the <code class="docutils literal"><span class="pre">vendor</span></code>
and <code class="docutils literal"><span class="pre">pkgs</span></code> subdirectories.</li>
</ul>
<p>Formally, the format described by the following BNF:</p>
<div class="highlight-abnf"><div class="highlight"><pre><span></span><span class="nc">FilePathGlob</span>    ::<span class="o">=</span> <span class="nc">FilePathRoot</span> <span class="nc">FilePathGlobRel</span>
<span class="nc">FilePathRoot</span>    ::<span class="o">=</span> {- <span class="nc">empty</span> -}        # <span class="nc">relative</span> <span class="nc">to</span> <span class="nc">cabal</span>.<span class="nc">project</span>
                  | <span class="l">&quot;/&quot;</span>                # <span class="nc">Unix</span> <span class="nc">root</span>
                  | <span class="p">[</span><span class="nc">a-zA-Z</span><span class="p">]</span> <span class="l">&quot;:&quot;</span> <span class="p">[</span><span class="o">/</span>\\<span class="p">]</span> # <span class="nc">Windows</span> <span class="nc">root</span>
                  | <span class="l">&quot;~&quot;</span>                # <span class="nc">home</span> <span class="nc">directory</span>
<span class="nc">FilePathGlobRel</span> ::<span class="o">=</span> <span class="nc">Glob</span> <span class="l">&quot;/&quot;</span>  <span class="nc">FilePathGlobRel</span> # <span class="nc">Unix</span> <span class="nc">directory</span>
                  | <span class="nc">Glob</span> <span class="l">&quot;\\&quot;</span> <span class="nc">FilePathGlobRel</span> # <span class="nc">Windows</span> <span class="nc">directory</span>
                  | <span class="nc">Glob</span>         # <span class="nc">file</span>
                  | {- <span class="nc">empty</span> -}  # <span class="nc">trailing</span> <span class="nc">slash</span>
<span class="nc">Glob</span>      ::<span class="o">=</span> <span class="nc">GlobPiece</span> <span class="o">*</span>
<span class="nc">GlobPiece</span> ::<span class="o">=</span> <span class="l">&quot;*&quot;</span>            # <span class="nc">wildcard</span>
            | <span class="p">[</span>^<span class="o">*</span>{},<span class="o">/</span>\\<span class="p">]</span> <span class="o">*</span>   # <span class="nc">literal</span> <span class="nc">string</span>
            | <span class="l">&quot;\\&quot;</span> <span class="p">[</span><span class="o">*</span>{},<span class="p">]</span>    # <span class="nc">escaped</span> <span class="nc">reserved</span> <span class="nc">character</span>
            | <span class="l">&quot;{&quot;</span> <span class="nc">Glob</span> <span class="l">&quot;,&quot;</span> ... <span class="l">&quot;,&quot;</span> <span class="nc">Glob</span> <span class="l">&quot;}&quot;</span> # <span class="nc">union</span> <span class="p">(</span><span class="nc">match</span> <span class="nc">any</span> <span class="nc">of</span> <span class="nc">these</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="global-configuration-options">
<h2>5.4.2. Global configuration options<a class="headerlink" href="#global-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>The following top-level configuration options are not specific to any
package, and thus apply globally:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">verbose:</span></code> <em>nat</em> (default: 1)</dt>
<dd><p class="first">Control the verbosity of <code class="docutils literal"><span class="pre">cabal</span></code> commands, valid values are from 0
to 3.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--verbose=2</span></code>; a short
form <code class="docutils literal"><span class="pre">-v2</span></code> is also supported.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">jobs:</span></code> <em>nat</em> or <code class="docutils literal"><span class="pre">$ncpus</span></code> (default: 1)</dt>
<dd><p class="first">Run <em>nat</em> jobs simultaneously when building. If <code class="docutils literal"><span class="pre">$ncpus</span></code> is
specified, run the number of jobs equal to the number of CPUs.
Package building is often quite parallel, so turning on parallelism
can speed up build times quite a bit!</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--jobs=2</span></code>; a short form
<code class="docutils literal"><span class="pre">-j2</span></code> is also supported; a bare <code class="docutils literal"><span class="pre">--jobs</span></code> or <code class="docutils literal"><span class="pre">-j</span></code> is equivalent
to <code class="docutils literal"><span class="pre">--jobs=$ncpus</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">keep-going:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">If true, after a build failure, continue to build other unaffected
packages.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--keep-going</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="solver-configuration-options">
<h2>5.4.3. Solver configuration options<a class="headerlink" href="#solver-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>The following settings control the behavior of the dependency solver:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">constraints:</span></code> <em>constraints</em> (comma separated)</dt>
<dd><p class="first">Add extra constraints to the version bounds, flag settings, and
other properties a solver can pick for a package. For example, to
only consider install plans that do not use <code class="docutils literal"><span class="pre">bar</span></code> at all, or use
<code class="docutils literal"><span class="pre">bar-2.1</span></code>, write:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">constraints</span><span class="p">:</span> bar <span class="o">==</span> 2.1
</pre></div>
</div>
<p>Version bounds have the same syntax as <code class="docutils literal"><span class="pre">build-depends</span></code>. You can
also specify flag assignments:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="c1">-- Require bar to be installed with the foo flag turned on and</span>
<span class="c1">-- the baz flag turned off</span>
<span class="k">constraints</span><span class="p">:</span> bar +foo -baz

<span class="c1">-- Require that bar NOT be present in the install plan. Note:</span>
<span class="c1">-- this is just syntax sugar for &#39;&gt; 1 &amp;&amp; &lt; 1&#39;, and is supported</span>
<span class="c1">-- by build-depends.</span>
<span class="k">constraints</span><span class="p">:</span> bar -none
</pre></div>
</div>
<p>A package can be specified multiple times in <code class="docutils literal"><span class="pre">constraints</span></code>, in
which case the specified constraints are intersected. This is
useful, since the syntax does not allow you to specify multiple
constraints at once. For example, to specify both version bounds and
flag assignments, you would write:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">constraints</span><span class="p">:</span> bar <span class="o">==</span> 2.1<span class="p">,</span>
             bar +foo -baz<span class="p">,</span>
</pre></div>
</div>
<p>There are also some more specialized constraints, which most people
don&#8217;t generally need:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="c1">-- Require bar to be preinstalled in the global package database</span>
<span class="c1">-- (this does NOT include the Nix-local build global store.)</span>
<span class="k">constraints</span><span class="p">:</span> bar installed

<span class="c1">-- Require the local source copy of bar to be used</span>
<span class="c1">-- (Note: By default, if we have a local package we will</span>
<span class="c1">-- automatically use it, so it generally not be necessary to</span>
<span class="c1">-- specify this)</span>
<span class="k">constraints</span><span class="p">:</span> bar source

<span class="c1">-- Require that bar be solved with test suites and benchmarks enabled</span>
<span class="c1">-- (Note: By default, new-build configures the solver to make</span>
<span class="c1">-- a best-effort attempt to enable these stanzas, so this generally</span>
<span class="c1">-- should not be necessary.)</span>
<span class="k">constraints</span><span class="p">:</span> bar test<span class="p">,</span>
             bar bench
</pre></div>
</div>
<p class="last">The command line variant of this field is
<code class="docutils literal"><span class="pre">--constraint=&quot;pkg</span> <span class="pre">&gt;=</span> <span class="pre">2.0&quot;</span></code>; to specify multiple constraints, pass
the flag multiple times.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">preferences:</span></code> <em>preference</em> (comma separated)</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">constraints</span></code>, but the solver will attempt to satisfy these
preferences on a best-effort basis. The resulting install is locally
optimal with respect to preferences; specifically, no single package
could be replaced with a more preferred version that still satisfies
the hard constraints.</p>
<p>Operationally, preferences can cause the solver to attempt certain
version choices of a package before others, which can improve
dependency solver runtime.</p>
<p>One way to use <code class="docutils literal"><span class="pre">preferences</span></code> is to take a known working set of
constraints (e.g., via <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-freeze</span></code>) and record them as
preferences. In this case, the solver will first attempt to use this
configuration, and if this violates hard constraints, it will try to
find the minimal number of upgrades to satisfy the hard constraints
again.</p>
<p class="last">The command line variant of this field is
<code class="docutils literal"><span class="pre">--preference=&quot;pkg</span> <span class="pre">&gt;=</span> <span class="pre">2.0&quot;</span></code>; to specify multiple preferences, pass
the flag multiple times.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">allow-newer:</span></code> <code class="docutils literal"><span class="pre">none</span></code> <em>or</em> <code class="docutils literal"><span class="pre">all</span></code> <em>or</em> <em>list of scoped package names</em> (space or comma separated, default: <code class="docutils literal"><span class="pre">none</span></code>)</dt>
<dd><p class="first">Allow the solver to pick an newer version of some packages than
would normally be permitted by than the <code class="docutils literal"><span class="pre">build-depends</span></code> bounds of
packages in the install plan. This option may be useful if the
dependency solver cannot otherwise find a valid install plan.</p>
<p>For example, to relax <code class="docutils literal"><span class="pre">pkg</span></code>s <code class="docutils literal"><span class="pre">build-depends</span></code> upper bound on
<code class="docutils literal"><span class="pre">dep-pkg</span></code>, write a scoped package name of the form:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">allow-newer</span><span class="p">:</span> pkg<span class="p">:</span>dep-pkg
</pre></div>
</div>
<p>This syntax is recommended, as it is often only a single package
whose upper bound is misbehaving. In this case, the upper bounds of
other packages should still be respected; indeed, relaxing the bound
can break some packages which test the selected version of packages.</p>
<p>However, in some situations (e.g., when attempting to build packages
on a new version of GHC), it is useful to disregard <em>all</em>
upper-bounds, with respect to a package or all packages. This can be
done by specifying just a package name, or using the keyword <code class="docutils literal"><span class="pre">all</span></code>
to specify all packages:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="c1">-- Disregard upper bounds involving the dependencies on</span>
<span class="c1">-- packages bar, baz and quux</span>
<span class="k">allow-newer</span><span class="p">:</span> bar<span class="p">,</span> baz<span class="p">,</span> quux

<span class="c1">-- Disregard all upper bounds when dependency solving</span>
<span class="k">allow-newer</span><span class="p">:</span> all
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">allow-newer</span></code> is often used in conjunction with a constraint (in
the <code class="docutils literal"><span class="pre">constraints</span></code> field) forcing the usage of a specific, newer
version of a package.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--allow-newer=bar</span></code>. A
bare <code class="docutils literal"><span class="pre">--allow-newer</span></code> is equivalent to <code class="docutils literal"><span class="pre">--allow-newer=all</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">allow-older:</span></code> <code class="docutils literal"><span class="pre">none</span></code> <em>or</em> <code class="docutils literal"><span class="pre">all</span></code> <em>or</em> <em>list of scoped package names</em> (space or comma separated, default: <code class="docutils literal"><span class="pre">none</span></code>)</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">allow-newer</span></code>, but applied to lower bounds rather than upper
bounds.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--allow-older=all</span></code>. A
bare <code class="docutils literal"><span class="pre">--allow-older</span></code> is equivalent to <code class="docutils literal"><span class="pre">--allow-older=all</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="package-configuration-options">
<h2>5.4.4. Package configuration options<a class="headerlink" href="#package-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Package options affect the building of specific packages. There are two
ways a package option can be specified:</p>
<ul class="simple">
<li>They can be specified at the top-level, in which case they apply only
to <strong>local package</strong>, or</li>
<li>They can be specified inside a <code class="docutils literal"><span class="pre">package</span></code> stanza, in which case they
apply to the build of the package, whether or not it is local or
external.</li>
</ul>
<p>For example, the following options specify that <code class="docutils literal"><span class="pre">optimization</span></code> should
be turned off for all local packages, and that <code class="docutils literal"><span class="pre">bytestring</span></code> (possibly
an external dependency) should be built with <code class="docutils literal"><span class="pre">-fno-state-hack</span></code>:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">optimization</span><span class="p">:</span> False

<span class="k">package</span> bytestring
<span class="w">    </span><span class="k">ghc-options</span><span class="p">:</span> -fno-state-hack
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">ghc-options</span></code> is not specifically described in this documentation,
but is one of many fields for configuring programs.  They take the form
<code class="docutils literal"><span class="pre">progname-options</span></code> and <code class="docutils literal"><span class="pre">progname-location</span></code>, and
can only be set inside package stanzas.  (TODO: They are not supported
at top-level, see <a class="reference external" href="https://github.com/haskell/cabal/issues/3579">#3579</a>.</p>
<p>At the moment, there is no way to specify an option to apply to all
external packages or all inplace packages. Additionally, it is only
possible to specify these options on the command line for all local
packages (there is no per-package command line interface.)</p>
<p>Some flags were added by more recent versions of the Cabal library. This
means that they are NOT supported by packages which use Custom setup
scripts that require a version of the Cabal library older than when the
feature was added.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">flags:</span></code> <em>list of +flagname or -flagname</em> (space separated)</dt>
<dd><p class="first">Force all flags specified as <code class="docutils literal"><span class="pre">+flagname</span></code> to be true, and all flags
specified as <code class="docutils literal"><span class="pre">-flagname</span></code> to be false. For example, to enable the
flag <code class="docutils literal"><span class="pre">foo</span></code> and disable <code class="docutils literal"><span class="pre">bar</span></code>, set:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">flags</span><span class="p">:</span> +foo -bar
</pre></div>
</div>
<p>If there is no leading punctuation, it is assumed that the flag
should be enabled; e.g., this is equivalent:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">flags</span><span class="p">:</span> foo -bar
</pre></div>
</div>
<p>Flags are <em>per-package</em>, so it doesn&#8217;t make much sense to specify
flags at the top-level, unless you happen to know that <em>all</em> of your
local packages support the same named flags. If a flag is not
supported by a package, it is ignored.</p>
<p>See also the solver configuration field <code class="docutils literal"><span class="pre">constraints</span></code>.</p>
<p>The command line variant of this flag is <code class="docutils literal"><span class="pre">--flags</span></code>. There is also
a shortened form <code class="docutils literal"><span class="pre">-ffoo</span> <span class="pre">-f-bar</span></code>.</p>
<p class="last">A common mistake is to say <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span> <span class="pre">-fhans</span></code>, where
<code class="docutils literal"><span class="pre">hans</span></code> is a flag for a transitive dependency that is not in the
local package; in this case, the flag will be silently ignored. If
<code class="docutils literal"><span class="pre">haskell-tor</span></code> is the package you want this flag to apply to, try
<code class="docutils literal"><span class="pre">--constraint=&quot;haskell-tor</span> <span class="pre">+hans&quot;</span></code> instead.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">with-compiler:</span></code> <em>executable</em></dt>
<dd><p class="first">Specify the path to a particular compiler to be used. If not an
absolute path, it will be resolved according to the <code class="docutils literal"><span class="pre">PATH</span></code>
environment. The type of the compiler (GHC, GHCJS, etc) must be
consistent with the setting of the <code class="docutils literal"><span class="pre">compiler</span></code> field.</p>
<p>The most common use of this option is to specify a different version
of your compiler to be used; e.g., if you have <code class="docutils literal"><span class="pre">ghc-7.8</span></code> in your
path, you can specify <code class="docutils literal"><span class="pre">with-compiler:</span> <span class="pre">ghc-7.8</span></code> to use it.</p>
<p>This flag also sets the default value of <code class="docutils literal"><span class="pre">with-hc-pkg</span></code>, using the
heuristic that it is named <code class="docutils literal"><span class="pre">ghc-pkg-7.8</span></code> (if your executable name
is suffixed with a version number), or is the executable named
<code class="docutils literal"><span class="pre">ghc-pkg</span></code> in the same directory as the <code class="docutils literal"><span class="pre">ghc</span></code> directory. If this
heuristic does not work, set <code class="docutils literal"><span class="pre">with-hc-pkg</span></code> explicitly.</p>
<p>For inplace packages, <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> maintains a separate build
directory for each version of GHC, so you can maintain multiple
build trees for different versions of GHC without clobbering each
other.</p>
<p>At the moment, it&#8217;s not possible to set <code class="docutils literal"><span class="pre">with-compiler</span></code> on a
per-package basis, but eventually we plan on relaxing this
restriction. If this is something you need, give us a shout.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--with-compiler=ghc-7.8</span></code>; there is also a short version
<code class="docutils literal"><span class="pre">-w</span> <span class="pre">ghc-7.8</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">with-hc-pkg:</span></code> <em>executable</em></dt>
<dd><p class="first">Specify the path to the package tool, e.g., <code class="docutils literal"><span class="pre">ghc-pkg</span></code>. This
package tool must be compatible with the compiler specified by
<code class="docutils literal"><span class="pre">with-compiler</span></code> (generally speaking, it should be precisely the
tool that was distributed with the compiler). If this option is
omitted, the default value is determined from <code class="docutils literal"><span class="pre">with-compiler</span></code>.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--with-hc-pkg=ghc-pkg-7.8</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">optimization:</span></code> <em>nat</em> (default: <code class="docutils literal"><span class="pre">1</span></code>)</dt>
<dd><p class="first">Build with optimization. This is appropriate for production use,
taking more time to build faster libraries and programs.</p>
<p>The optional <em>nat</em> value is the optimisation level. Some compilers
support multiple optimisation levels. The range is 0 to 2. Level 0
disables optimization, level 1 is the default. Level 2 is higher
optimisation if the compiler supports it. Level 2 is likely to lead
to longer compile times and bigger generated code. If you are not
planning to run code, turning off optimization will lead to better
build times and less code to be rebuilt when a module changes.</p>
<p>We also accept <code class="docutils literal"><span class="pre">True</span></code> (equivalent to 1) and <code class="docutils literal"><span class="pre">False</span></code> (equivalent
to 0).</p>
<p>Note that as of GHC 8.0, GHC does not recompile when optimization
levels change (see <a class="reference external" href="http://ghc.haskell.org/trac/ghc/ticket/10923">GHC #10923</a>), so if
you change the optimization level for a local package you may need
to blow away your old build products in order to rebuild with the
new optimization level.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">-O2</span></code> (with <code class="docutils literal"><span class="pre">-O1</span></code>
equivalent to <code class="docutils literal"><span class="pre">-O</span></code>). There are also long-form variants
<code class="docutils literal"><span class="pre">--enable-optimization</span></code> and <code class="docutils literal"><span class="pre">--disable-optimization</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">configure-options:</span></code> <em>args</em> (space separated)</dt>
<dd><p class="first">A list of extra arguments to pass to the external <code class="docutils literal"><span class="pre">./configure</span></code>
script, if one is used. This is only useful for packages which have
the <code class="docutils literal"><span class="pre">Configure</span></code> build type. See also the section on
<a class="reference external" href="developing-packages.html#system-dependent-parameters">system-dependent
parameters</a>.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--configure-option=arg</span></code>,
which can be specified multiple times to pass multiple options.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">compiler:</span></code> <code class="docutils literal"><span class="pre">ghc</span></code> <em>or</em> <code class="docutils literal"><span class="pre">ghcjs</span></code> <em>or</em> <code class="docutils literal"><span class="pre">jhc</span></code> <em>or</em> <code class="docutils literal"><span class="pre">lhc</span></code> <em>or</em> <code class="docutils literal"><span class="pre">uhc</span></code> <em>or</em> <code class="docutils literal"><span class="pre">haskell-suite</span></code> (default: <code class="docutils literal"><span class="pre">ghc</span></code>)</dt>
<dd><p class="first">Specify which compiler toolchain to be used. This is independent of
<code class="docutils literal"><span class="pre">with-compiler</span></code>, because the choice of toolchain affects Cabal&#8217;s
build logic.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--compiler=ghc</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">tests:</span></code> <em>boolean</em> (default: <code class="docutils literal"><span class="pre">False</span></code>)</dt>
<dd><p class="first">Force test suites to be enabled. For most users this should not be
needed, as we always attempt to solve for test suite dependencies,
even when this value is <code class="docutils literal"><span class="pre">False</span></code>; furthermore, test suites are
automatically enabled if they are requested as a built target.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-tests</span></code> and
<code class="docutils literal"><span class="pre">--disable-tests</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">benchmarks:</span></code> <em>boolean</em> (default: <code class="docutils literal"><span class="pre">False</span></code>)</dt>
<dd><p class="first">Force benchmarks to be enabled. For most users this should not be
needed, as we always attempt to solve for benchmark dependencies,
even when this value is <code class="docutils literal"><span class="pre">False</span></code>; furthermore, benchmarks are
automatically enabled if they are requested as a built target.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-benchmarks</span></code> and
<code class="docutils literal"><span class="pre">--disable-benchmarks</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">extra-prog-path:</span></code> <em>paths</em> (newline or comma separated, added in Cabal 1.18)</dt>
<dd><p class="first">A list of directories to search for extra required programs. Most
users should not need this, as programs like <code class="docutils literal"><span class="pre">happy</span></code> and <code class="docutils literal"><span class="pre">alex</span></code>
will automatically be installed and added to the path. This can be
useful if a <code class="docutils literal"><span class="pre">Custom</span></code> setup script relies on an exotic extra
program.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--extra-prog-path=PATH</span></code>,
which can be specified multiple times.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">run-tests:</span></code> <em>boolean</em> (default: <code class="docutils literal"><span class="pre">False</span></code>)</dt>
<dd><p class="first">Run the package test suite upon installation. This is useful for
saying &#8220;When this package is installed, check that the test suite
passes, terminating the rest of the build if it is broken.&#8221;</p>
<p>One deficiency: the <code class="docutils literal"><span class="pre">run-test</span></code> setting of a package is NOT
recorded as part of the hash, so if you install something without
<code class="docutils literal"><span class="pre">run-tests</span></code> and then turn on <code class="docutils literal"><span class="pre">run-tests</span></code>, we won&#8217;t subsequently
test the package. If this is causing you problems, give us a shout.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--run-tests</span></code>.</p>
</dd>
</dl>
<div class="section" id="object-code-options">
<h3>5.4.4.1. Object code options<a class="headerlink" href="#object-code-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">debug-info:</span></code> <em>boolean</em> (default: False, added in Cabal 1.22)</dt>
<dd><p class="first">If the compiler (e.g., GHC 7.10 and later) supports outputing OS
native debug info (e.g., DWARF), setting <code class="docutils literal"><span class="pre">debug-info:</span> <span class="pre">True</span></code> will
instruct it to do so. See the GHC wiki page on <a class="reference external" href="http://ghc.haskell.org/trac/ghc/wiki/DWARF">DWARF</a>
for more information about this feature.</p>
<p>(This field also accepts numeric syntax, but as of GHC 8.0 this
doesn&#8217;t do anything.)</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-debug-info</span></code> and
<code class="docutils literal"><span class="pre">--disable-debug-info</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">split-objs:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Use the GHC <code class="docutils literal"><span class="pre">-split-objs</span></code> feature when building the library. This
reduces the final size of the executables that use the library by
allowing them to link with only the bits that they use rather than
the entire library. The downside is that building the library takes
longer and uses considerably more memory.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-split-objs</span></code> and
<code class="docutils literal"><span class="pre">--disable-split-objs</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">executable-stripping:</span></code> <em>boolean</em> (default: True)</dt>
<dd><p class="first">When installing binary executable programs, run the <code class="docutils literal"><span class="pre">strip</span></code>
program on the binary. This can considerably reduce the size of the
executable binary file. It does this by removing debugging
information and symbols.</p>
<p>Not all Haskell implementations generate native binaries. For such
implementations this option has no effect.</p>
<p>(TODO: Check what happens if you combine this with <code class="docutils literal"><span class="pre">debug-info</span></code>.)</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-executable-stripping</span></code> and
<code class="docutils literal"><span class="pre">--disable-executable-stripping</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-stripping:</span></code> <em>boolean</em> (added in Cabal 1.19)</dt>
<dd><p class="first">When installing binary libraries, run the <code class="docutils literal"><span class="pre">strip</span></code> program on the
binary, saving space on the file system. See also
<code class="docutils literal"><span class="pre">executable-stripping</span></code>.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-library-stripping</span></code> and <code class="docutils literal"><span class="pre">--disable-library-stripping</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="executable-options">
<h3>5.4.4.2. Executable options<a class="headerlink" href="#executable-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">program-prefix:</span></code> <em>prefix</em></dt>
<dd><p class="first">[STRIKEOUT:Prepend <em>prefix</em> to installed program names.] (Currently
implemented in a silly and not useful way. If you need this to work
give us a shout.)</p>
<p><em>prefix</em> may contain the following path variables: <code class="docutils literal"><span class="pre">$pkgid</span></code>,
<code class="docutils literal"><span class="pre">$pkg</span></code>, <code class="docutils literal"><span class="pre">$version</span></code>, <code class="docutils literal"><span class="pre">$compiler</span></code>, <code class="docutils literal"><span class="pre">$os</span></code>, <code class="docutils literal"><span class="pre">$arch</span></code>, <code class="docutils literal"><span class="pre">$abi</span></code>,
<code class="docutils literal"><span class="pre">$abitag</span></code></p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--program-prefix=foo-</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">program-suffix:</span></code> <em>suffix</em></dt>
<dd><p class="first">[STRIKEOUT:Append <em>suffix</em> to installed program names.] (Currently
implemented in a silly and not useful way. If you need this to work
give us a shout.)</p>
<p>The most obvious use for this is to append the program&#8217;s version
number to make it possible to install several versions of a program
at once: <code class="docutils literal"><span class="pre">program-suffix:</span> <span class="pre">$version</span></code>.</p>
<p><em>suffix</em> may contain the following path variables: <code class="docutils literal"><span class="pre">$pkgid</span></code>,
<code class="docutils literal"><span class="pre">$pkg</span></code>, <code class="docutils literal"><span class="pre">$version</span></code>, <code class="docutils literal"><span class="pre">$compiler</span></code>, <code class="docutils literal"><span class="pre">$os</span></code>, <code class="docutils literal"><span class="pre">$arch</span></code>, <code class="docutils literal"><span class="pre">$abi</span></code>,
<code class="docutils literal"><span class="pre">$abitag</span></code></p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--program-suffix='$version'</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="dynamic-linking-options">
<h3>5.4.4.3. Dynamic linking options<a class="headerlink" href="#dynamic-linking-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">shared:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Build shared library. This implies a separate compiler run to
generate position independent code as required on most platforms.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-shared</span></code> and
<code class="docutils literal"><span class="pre">--disable-shared</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">executable-dynamic:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Link executables dynamically. The executable&#8217;s library dependencies
should be built as shared objects. This implies <code class="docutils literal"><span class="pre">shared:</span> <span class="pre">True</span></code>
unless <code class="docutils literal"><span class="pre">shared:</span> <span class="pre">False</span></code> is explicitly specified.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-executable-dynamic</span></code> and
<code class="docutils literal"><span class="pre">--disable-executable-dynamic</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-for-ghci:</span></code> <em>boolean</em> (default: True)</dt>
<dd><p class="first">Build libraries suitable for use with GHCi. This involves an extra
linking step after the build.</p>
<p>Not all platforms support GHCi and indeed on some platforms, trying
to build GHCi libs fails. In such cases, consider setting
<code class="docutils literal"><span class="pre">library-for-ghci:</span> <span class="pre">False</span></code>.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-library-for-ghci</span></code> and <code class="docutils literal"><span class="pre">--disable-library-for-ghci</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">relocatable:</span></code> (default: False, added in Cabal 1.21)</dt>
<dd><p class="first">[STRIKEOUT:Build a package which is relocatable.] (TODO: It is not
clear what this actually does, or if it works at all.)</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--relocatable</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="foreign-function-interface-options">
<h3>5.4.4.4. Foreign function interface options<a class="headerlink" href="#foreign-function-interface-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">extra-include-dirs:</span></code> <em>directories</em> (comma or newline separated list)</dt>
<dd><p class="first">An extra directory to search for C header files. You can use this
flag multiple times to get a list of directories.</p>
<p>You might need to use this flag if you have standard system header
files in a non-standard location that is not mentioned in the
package&#8217;s <code class="docutils literal"><span class="pre">.cabal</span></code> file. Using this option has the same affect as
appending the directory <em>dir</em> to the <code class="docutils literal"><span class="pre">include-dirs</span></code> field in each
library and executable in the package&#8217;s <code class="docutils literal"><span class="pre">.cabal</span></code> file. The
advantage of course is that you do not have to modify the package at
all. These extra directories will be used while building the package
and for libraries it is also saved in the package registration
information and used when compiling modules that use the library.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--extra-include-dirs=DIR</span></code>, which can be specified multiple times.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">extra-lib-dirs:</span></code> <em>directories</em> (comma or newline separated list)</dt>
<dd><p class="first">An extra directory to search for system libraries files.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--extra-lib-dirs=DIR</span></code>,
which can be specified multiple times.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">extra-framework-dirs:</span></code> <em>directories</em> (comma or newline separated list)</dt>
<dd><p class="first">An extra directory to search for frameworks (OS X only).</p>
<p>You might need to use this flag if you have standard system
libraries in a non-standard location that is not mentioned in the
package&#8217;s <code class="docutils literal"><span class="pre">.cabal</span></code> file. Using this option has the same affect as
appending the directory <em>dir</em> to the <code class="docutils literal"><span class="pre">extra-lib-dirs</span></code> field in
each library and executable in the package&#8217;s <code class="docutils literal"><span class="pre">.cabal</span></code> file. The
advantage of course is that you do not have to modify the package at
all. These extra directories will be used while building the package
and for libraries it is also saved in the package registration
information and used when compiling modules that use the library.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--extra-framework-dirs=DIR</span></code>, which can be specified multiple
times.</p>
</dd>
</dl>
</div>
<div class="section" id="profiling-options">
<h3>5.4.4.5. Profiling options<a class="headerlink" href="#profiling-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">profiling:</span></code> <em>boolean</em> (default: False, added in Cabal 1.21)</dt>
<dd><p class="first">Build libraries and executables with profiling enabled (for
compilers that support profiling as a separate mode). It is only
necessary to specify <code class="docutils literal"><span class="pre">profiling</span></code> for the specific package you want
to profile; <code class="docutils literal"><span class="pre">cabal</span> <span class="pre">new-build</span></code> will ensure that all of its
transitive dependencies are built with profiling enabled.</p>
<p>To enable profiling for only libraries or executables, see
<code class="docutils literal"><span class="pre">library-profiling</span></code> and <code class="docutils literal"><span class="pre">executable-profiling</span></code>.</p>
<p>For useful profiling, it can be important to control precisely what
cost centers are allocated; see <code class="docutils literal"><span class="pre">profiling-detail</span></code>.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-profiling</span></code> and
<code class="docutils literal"><span class="pre">--disable-profiling</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-vanilla:</span></code> <em>boolean</em> (default: True)</dt>
<dd><p class="first">Build ordinary libraries (as opposed to profiling libraries).
Mostly, you can set this to False to avoid building ordinary
libraries when you are profiling.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-library-vanilla</span></code> and <code class="docutils literal"><span class="pre">--disable-library-vanilla</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-profiling:</span></code> <em>boolean</em> (default: False, added in Cabal 1.21)</dt>
<dd><p class="first">Build libraries with profiling enabled.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-library-profiling</span></code> and <code class="docutils literal"><span class="pre">--disable-library-profiling</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">executable-profiling:</span></code> <em>boolean</em> (default: False, added in Cabal 1.21)</dt>
<dd><p class="first">Build executables with profiling enabled.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-executable-profiling</span></code> and
<code class="docutils literal"><span class="pre">--disable-executable-profiling</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">profiling-detail:</span></code> <em>level</em> (added in Cabal 1.23)</dt>
<dd><p class="first">Some compilers that support profiling, notably GHC, can allocate
costs to different parts of the program and there are different
levels of granularity or detail with which this can be done. In
particular for GHC this concept is called &#8220;cost centers&#8221;, and GHC
can automatically add cost centers, and can do so in different ways.</p>
<p>This flag covers both libraries and executables, but can be
overridden by the <code class="docutils literal"><span class="pre">library-profiling-detail</span></code> field.</p>
<p>Currently this setting is ignored for compilers other than GHC. The
levels that cabal currently supports are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">default</span></code></dt>
<dd>For GHC this uses <code class="docutils literal"><span class="pre">exported-functions</span></code> for libraries and
<code class="docutils literal"><span class="pre">toplevel-functions</span></code> for executables.</dd>
<dt><code class="docutils literal"><span class="pre">none</span></code></dt>
<dd>No costs will be assigned to any code within this component.</dd>
<dt><code class="docutils literal"><span class="pre">exported-functions</span></code></dt>
<dd>Costs will be assigned at the granularity of all top level
functions exported from each module. In GHC specifically, this
is for non-inline functions.</dd>
<dt><code class="docutils literal"><span class="pre">toplevel-functions</span></code></dt>
<dd>Costs will be assigned at the granularity of all top level
functions in each module, whether they are exported from the
module or not. In GHC specifically, this is for non-inline
functions.</dd>
<dt><code class="docutils literal"><span class="pre">all-functions</span></code></dt>
<dd>Costs will be assigned at the granularity of all functions in
each module, whether top level or local. In GHC specifically,
this is for non-inline toplevel or where-bound functions or
values.</dd>
</dl>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--profiling-detail=none</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-profiling-detail:</span></code> <em>level</em> (added in Cabal 1.23)</dt>
<dd><p class="first">Like <code class="docutils literal"><span class="pre">profiling-detail</span></code>, but applied only to libraries</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--library-profiling-detail=none</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="coverage-options">
<h3>5.4.4.6. Coverage options<a class="headerlink" href="#coverage-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">coverage:</span></code> <em>boolean</em> (default: False, added in Cabal 1.21)</dt>
<dd><p class="first">Build libraries and executables (including test suites) with Haskell
Program Coverage enabled. Running the test suites will automatically
generate coverage reports with HPC.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-coverage</span></code> and
<code class="docutils literal"><span class="pre">--disable-coverage</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">library-coverage:</span></code> <em>boolean</em> (default: False, added in Cabal 1.21)</dt>
<dd><p class="first">Deprecated, use <code class="docutils literal"><span class="pre">coverage</span></code>.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--enable-library-coverage</span></code> and <code class="docutils literal"><span class="pre">--disable-library-coverage</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="haddock-options">
<h3>5.4.4.7. Haddock options<a class="headerlink" href="#haddock-options" title="Permalink to this headline">¶</a></h3>
<p>Documentation building support is fairly sparse at the moment. Let us
know if it&#8217;s a priority for you!</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">documentation:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Enables building of Haddock documentation</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--enable-documentation</span></code>
and <code class="docutils literal"><span class="pre">--disable-documentation</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">doc-index-file</span></code>: <em>templated path</em></dt>
<dd><p class="first">A central index of Haddock API documentation (template cannot use
<code class="docutils literal"><span class="pre">$pkgid</span></code>), which should be updated as documentation is built.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--doc-index-file=TEMPLATE</span></code></p>
</dd>
</dl>
<p>The following commands are equivalent to ones that would be passed when
running <code class="docutils literal"><span class="pre">setup</span> <span class="pre">haddock</span></code>. (TODO: Where does the documentation get put.)</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">haddock-hoogle:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Generate a text file which can be converted by <a class="reference external" href="http://www.haskell.org/hoogle/">Hoogle</a>
into a database for searching. This is equivalent to running <code class="docutils literal"><span class="pre">haddock</span></code>
with the <code class="docutils literal"><span class="pre">--hoogle</span></code> flag.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--hoogle</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> command).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-html:</span></code> <em>boolean</em> (default: True)</dt>
<dd><p class="first">Build HTML documentation.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--html</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> command).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-html-location:</span></code> <em>templated path</em></dt>
<dd><p class="first">Specify a template for the location of HTML documentation for
prerequisite packages. The substitutions are applied to the template
to obtain a location for each package, which will be used by
hyperlinks in the generated documentation. For example, the
following command generates links pointing at [Hackage] pages:</p>
<div class="highlight-cabal"><div class="highlight"><pre><span></span><span class="k">html-location</span><span class="p">:</span> &#39;http<span class="p">:</span>//hackage.haskell.org/packages/archive/$pkg/latest/doc/html&#39;
</pre></div>
</div>
<p>Here the argument is quoted to prevent substitution by the shell. If
this option is omitted, the location for each package is obtained
using the package tool (e.g. <code class="docutils literal"><span class="pre">ghc-pkg</span></code>).</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--html-location</span></code> (for
the <code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-executables:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Run haddock on all executable programs.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--executables</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-tests:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Run haddock on all test suites.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--tests</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-benchmarks:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Run haddock on all benchmarks.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--benchmarks</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-all:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Run haddock on all components.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--all</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-internal:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Build haddock documentation which includes unexposed modules and
symbols.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--internal</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-css:</span></code> <em>path</em></dt>
<dd><p class="first">The CSS file that should be used to style the generated
documentation (overriding haddock&#8217;s default.)</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--css</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-hyperlink-source:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Generated hyperlinked source code using <code class="docutils literal"><span class="pre">HsColour</span></code>, and have
Haddock documentation link to it.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--hyperlink-source</span></code> (for
the <code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-hscolour-css:</span></code> <em>path</em></dt>
<dd><p class="first">The CSS file that should be used to style the generated hyperlinked
source code (from <code class="docutils literal"><span class="pre">HsColour</span></code>).</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--hscolour-css</span></code> (for the
<code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-contents-location:</span></code> <em>url</em></dt>
<dd><p class="first">A baked-in URL to be used as the location for the contents page.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--contents-location</span></code>
(for the <code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
<dt><code class="docutils literal"><span class="pre">haddock-keep-temp-files:</span></code></dt>
<dd><p class="first">Keep temporary files.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--keep-temp-files</span></code> (for
the <code class="docutils literal"><span class="pre">haddock</span></code> subcommand).</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="advanced-global-configuration-options">
<h2>5.4.5. Advanced global configuration options<a class="headerlink" href="#advanced-global-configuration-options" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">http-transport:</span></code> <code class="docutils literal"><span class="pre">curl</span></code> or <code class="docutils literal"><span class="pre">wget</span></code> or <code class="docutils literal"><span class="pre">powershell</span></code> or <code class="docutils literal"><span class="pre">plain-http</span></code> (default: <code class="docutils literal"><span class="pre">curl</span></code>)</dt>
<dd><p class="first">Set a transport to be used when making http(s) requests.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--http-transport=curl</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">ignore-expiry:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">If <code class="docutils literal"><span class="pre">True</span></code>, we will ignore expiry dates on metadata from Hackage.</p>
<p>In general, you should not set this to <code class="docutils literal"><span class="pre">True</span></code> as it will leave you
vulnerable to stale cache attacks. However, it may be temporarily
useful if the main Hackage server is down, and we need to rely on
mirrors which have not been updated for longer than the expiry
period on the timestamp.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--ignore-expiry</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">remote-repo-cache:</span></code> <em>directory</em> (default: <code class="docutils literal"><span class="pre">~/.cabal/packages</span></code>)</dt>
<dd><p class="first">[STRIKEOUT:The location where packages downloaded from remote
repositories will be cached.] Not implemented yet.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--remote-repo-cache=DIR</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">logs-dir:</span></code> <em>directory</em> (default: <code class="docutils literal"><span class="pre">~/.cabal/logs</span></code>)</dt>
<dd><p class="first">[STRIKEOUT:The location where build logs for packages are stored.]
Not implemented yet.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--logs-dir=DIR</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">build-summary:</span></code> <em>template filepath</em> (default: <code class="docutils literal"><span class="pre">~/.cabal/logs/build.log</span></code>)</dt>
<dd><p class="first">[STRIKEOUT:The file to save build summaries. Valid variables which
can be used in the path are <code class="docutils literal"><span class="pre">$pkgid</span></code>, <code class="docutils literal"><span class="pre">$compiler</span></code>, <code class="docutils literal"><span class="pre">$os</span></code> and
<code class="docutils literal"><span class="pre">$arch</span></code>.] Not implemented yet.</p>
<p class="last">The command line variant of this flag is
<code class="docutils literal"><span class="pre">--build-summary=TEMPLATE</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">local-repo:</span></code> <em>directory</em></dt>
<dd><p class="first">[STRIKEOUT:The location of a local repository.] Deprecated. See
&#8220;Legacy repositories.&#8221;</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--local-repo=DIR</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">world-file:</span></code> <em>path</em></dt>
<dd><p class="first">[STRIKEOUT:The location of the world file.] Deprecated.</p>
<p class="last">The command line variant of this flag is <code class="docutils literal"><span class="pre">--world-file=FILE</span></code>.</p>
</dd>
</dl>
<p>Undocumented fields: <code class="docutils literal"><span class="pre">root-cmd</span></code>, <code class="docutils literal"><span class="pre">symlink-bindir</span></code>, <code class="docutils literal"><span class="pre">build-log</span></code>,
<code class="docutils literal"><span class="pre">remote-build-reporting</span></code>, <code class="docutils literal"><span class="pre">report-planned-failure</span></code>, <code class="docutils literal"><span class="pre">one-shot</span></code>,
<code class="docutils literal"><span class="pre">offline</span></code>.</p>
<div class="section" id="advanced-solver-options">
<h3>5.4.5.1. Advanced solver options<a class="headerlink" href="#advanced-solver-options" title="Permalink to this headline">¶</a></h3>
<p>Most users generally won&#8217;t need these.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">solver:</span></code> <code class="docutils literal"><span class="pre">modular</span></code></dt>
<dd><p class="first">This field is reserved to allow the specification of alternative
dependency solvers. At the moment, the only accepted option is
<code class="docutils literal"><span class="pre">modular</span></code>.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--solver=modular</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">max-backjumps:</span></code> <em>nat</em> (default: 2000)</dt>
<dd><p class="first">Maximum number of backjumps (backtracking multiple steps) allowed
while solving. Set -1 to allow unlimited backtracking, and 0 to
disable backtracking completely.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--max-backjumps=2000</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">reorder-goals:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">When enabled, the solver will reorder goals according to certain
heuristics. Slows things down on average, but may make backtracking
faster for some packages. It&#8217;s unlikely to help for small projects,
but for big install plans it may help you find a plan when otherwise
this is not possible. See <a class="reference external" href="https://github.com/haskell/cabal/issues/1780">#1780</a> for more commentary.</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--(no-)reorder-goals</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">count-conflicts:</span></code> <em>boolean</em> (default: True)</dt>
<dd><p class="first">Try to speed up solving by preferring goals that are involved in a
lot of conflicts.</p>
<p class="last">The command line variant of this field is
<code class="docutils literal"><span class="pre">--(no-)count-conflicts</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">strong-flags:</span></code> <em>boolean</em> (default: False)</dt>
<dd><p class="first">Do not defer flag choices. (TODO: Better documentation.)</p>
<p class="last">The command line variant of this field is <code class="docutils literal"><span class="pre">--(no-)strong-flags</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">cabal-lib-version:</span></code> <em>version</em></dt>
<dd><p class="first">This field selects the version of the Cabal library which should be
used to build packages. This option is intended primarily for
internal development use (e.g., forcing a package to build with a
newer version of Cabal, to test a new version of Cabal.) (TODO:
Specify its semantics more clearly.)</p>
<p class="last">The command line variant of this field is
<code class="docutils literal"><span class="pre">--cabal-lib-version=1.24.0.1</span></code>.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="nix-local-build-overview.html" class="btn btn-neutral" title="5. Nix-style Local Builds" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Cabal Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.25',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>